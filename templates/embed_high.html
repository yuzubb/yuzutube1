<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ video_title }} - High Quality Stream</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: black;
        }
        #video-container {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #video-player {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        #audio-player {
            display: none; /* 音声は非表示 */
        }
    </style>
</head>
<body>
    <div id="video-container">
        <video id="video-player" controls playsinline muted>
            <source src="{{ video_url }}" type="video/mp4">
            ブラウザが動画タグをサポートしていません。
        </video>
        
        <audio id="audio-player" preload="auto">
            <source src="{{ audio_url }}" type="audio/mp4">
        </audio>
    </div>

    <script>
        const video = document.getElementById('video-player');
        const audio = document.getElementById('audio-player');

        // --- ユーザー操作によるミュート解除 (オプション) ---
        // ユーザーが動画領域を一度でも操作したらミュートを解除し、音声を有効にする
        video.addEventListener('click', () => {
            if (video.muted) {
                video.muted = false; // ミュート解除
                console.log("Mute removed by user interaction. Sound enabled.");
            }
        });

        // --- 継続的な追尾（同期）処理 ---

        // 動画の再生イベントにフックし、音声を同期・再生させる
        video.addEventListener('play', () => {
            // 再生開始時、または再開時に同期を試みる
            // 動画と音声の再生時間のずれが0.2秒以上あれば、音声時間を動画時間に合わせる（追尾）
            if (Math.abs(video.currentTime - audio.currentTime) > 0.2) {
                audio.currentTime = video.currentTime;
            }
            
            // 動画が再生されたら音声も再生（追尾）
            // ユーザーが動画の再生ボタンを押した時に、このplayイベントが発火します
            audio.play().catch(e => console.error("Audio play failed on video play event:", e));
        });

        video.addEventListener('pause', () => {
            // 動画が一時停止したら音声も一時停止（追尾）
            audio.pause();
        });
        
        video.addEventListener('seeking', () => {
            // 動画がシークされたら音声もシーク（追尾）
            audio.currentTime = video.currentTime;
        });

    </script>
</body>
</html>
